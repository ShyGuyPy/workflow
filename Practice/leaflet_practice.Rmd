---
title: "leaflet_practice"
author: "Luke Vawter"
date: "October 18, 2018"
output: html_document
---

a place to practice leaflet maps

```{r}
library(shiny)
library(leaflet)
library(dplyr)

df = read.csv("./cedr_phyto_station.csv", stringsAsFactors = F)

df$latitude <- as.numeric(df$latitude)
df$longitude <- as.numeric(df$longitude)

ui <- fluidPage(
    leafletOutput("mymap", height = 1000)
)

server <- function(input, output, session){
  
data <- reactive({
  x <- df
})
  
output$mymap <- renderLeaflet({
  m<-leaflet(data=df) %>%
    addTiles() %>%
    #setView(lng=73.935242, lat = 40.730610, zoom=10)
    addMarkers(lng= ~ longitude,
               lat= ~ latitude,
               popup = paste("Station", df$station, "<br>",
                             "Year:", df$stationdescription))
  m
})
}

shinyApp(ui = ui, server = server)
```

from a youtube tutorial
https://www.youtube.com/watch?v=07UB1lfHV-o :
```{r}
library(leaflet)
library(rgdal)

project.dir <- rprojroot::find_rstudio_root_file()

download.file("http://thematicmapping.org/downloads/TM_WORLD_BORDERS_SIMPL-0.3.zip",destfile = "TM_WORLD_BORDERS_SIMPL-0.3")

unzip("TM_WORLD_BORDERS_SIMPL-0.3.zip")

my_map = readOGR(dsn=getwd(), layer = "TM_WORLD_BORDERS_SIMPL-0.3")
# head(my_map)
# summary(my_map)
# 
# head(my_map$data)

leaflet(data = my_map) %>%
  addTiles() %>%
  setView(lat = 10, lng = 0, zoom = 2) %>%
  addPolygons(fillColor = "teal",
              highlight= highlightOptions(weight = 5,
                                          color="red",
                                          fillOpacity = .7,
                                          bringToFront = TRUE),
              label=my_map$NAME)

```

```{r}
library(shiny)
library(leaflet)
library(dplyr)
library(choroplethr)
library(choroplethrMaps)
library(rgdal)

project.dir <- rprojroot::find_rstudio_root_file()

# east.border <- readxl::read_excel(file.path(project.dir, "2018DREX_notes\data\Drought_Regions\eastern-region-border.shp"))


#file.path(project.dir, "2018DREX_notes\data\Drought_Regions")

map_path <- file.path(project.dir, "2018DREX_notes\\data\\Drought_Regions")

eastern_region = readOGR(dsn=map_path, layer = "eastern-region")
#head(eastern_region)
summary(eastern_region)
head(eastern_region$data)

#ereg <- spTransform(eastern_region, CRS("+init=epsg:4326"))

leaflet() %>%
  addTiles() %>%
  setView(lng=-77.01293195597827, lat=38.987549813483675, zoom = 6) %>%
  addPolygons(data = ereg,fillColor = "red",
              highlight= highlightOptions(weight = 5,
                                          color="blue",
                                          fillOpacity = .7,
                                          bringToFront = TRUE),
              label=eastern_region$COUNTY
)

```

https://rstudio.github.io/leaflet/shapes.html
currently broken... to be continued:
```{r}
library(rgdal)

download.file("https://www.census.gov/geo/maps-data/data/cbf/cbf_state.html",destfile = "cb_2017_us_state_500k.zip")

unzip("cb_2017_us_state_500k.zip")

# From https://www.census.gov/geo/maps-data/data/cbf/cbf_state.html
states <- readOGR(dsn=getwd(), "shp/cb_2013_us_state_20m.shp",
  layer = "cb_2013_us_state_20m", GDAL1_integer64_policy = TRUE)

neStates <- subset(states, states$STUSPS %in% c(
  "CT","ME","MA","NH","RI","VT","NY","NJ","PA"
))

leaflet(neStates) %>%
  addPolygons(color = "#444444", weight = 1, smoothFactor = 0.5,
    opacity = 1.0, fillOpacity = 0.5,
    fillColor = ~colorQuantile("YlOrRd", ALAND)(ALAND),
    highlightOptions = highlightOptions(color = "white", weight = 2,
      bringToFront = TRUE))
```



working template, rough non-functional scratch paper at the moment:
```{r}
library(shiny)
library(leaflet)
library(dplyr)
library(choroplethr)
library(choroplethrMaps)

project.dir <- rprojroot::find_rstudio_root_file()

east.border <- readxl::read_excel(file.path(project.dir, "2018DREX_notes\data\Drought_Regions\eastern-region-border.shp"))





erb = readOGR(file.path(project.dir, "2018DREX_notes\data\Drought_Regions\eastern-region-border.shp"), layer = "eastern-region-border")



ui <- fluidPage(
    leafletOutput("mymap", height = 1000)
)

server <- function(input, output, session){
  
data <- reactive({
  x <- df
})
  
output$mymap <- renderLeaflet({
  m<-leaflet(data=df) %>%
    addTiles() %>%
    #setView(lng=73.935242, lat = 40.730610, zoom=10)
    addMarkers(lng= ~ longitude,
               lat= ~ latitude,
               popup = paste("Station", df$station, "<br>",
                             "Year:", df$stationdescription))
  m
})
}

```

